# ⚠️  BROKEN DEPLOYMENT — This file has intentional bugs. See docs/troubleshooting.md
---
apiVersion: apps/v1
kind: Deploymentt          # BUG 1: Typo in Kind — "Deploymentt" should be "Deployment"
metadata:
  name: api-gateway
  namespace: production
spec:
  replicas: 0              # BUG 2: replicas: 0 — no pods will ever start
  selector:
    matchLabels:
      app: api-gateway
  template:
    metadata:
      labels:
        app: backend       # BUG 3: label mismatch — selector expects "api-gateway", pod has "backend"
    spec:
      containers:
        - name: api-gateway
          image: api-gateway:latest  # BUG 4: no registry prefix — will fail to pull in most clusters
          ports:
            - containerPort: 8080   # BUG 5: wrong port — app listens on 3000, not 8080
          env:
            - name: USER_SERVICE_URL
              value: "http://userservice:3001"  # BUG 6: wrong service name — should be "user-service"
          resources:
            requests:
              cpu: "4000m"          # BUG 7: resource requests too high — 4 CPU cores requested, likely unschedulable
              memory: "8Gi"
            limits:
              cpu: "100m"           # BUG 8: limit < request — CPU limit (100m) is lower than request (4000m), invalid
              memory: "64Mi"
          livenessProbe:
            httpGet:
              path: /healthz
              port: 8080            # BUG 9: probe hits wrong port (8080) and wrong path (/healthz vs /health/live)
            initialDelaySeconds: 0
            periodSeconds: 1        # BUG 10: probes fire every 1 second — too aggressive, will kill healthy pods under load
            failureThreshold: 1     # BUG 11: failureThreshold: 1 — single failure causes restart, no tolerance for transient errors
---
apiVersion: v1
kind: Service
metadata:
  name: api-gateway
  namespace: production
spec:
  selector:
    app: gateway            # BUG 12: selector doesn't match pod label "api-gateway" — no endpoints will be registered
  ports:
    - port: 80
      targetPort: 8080      # BUG 5 repeated: targets wrong container port
  type: LoadBalancer
